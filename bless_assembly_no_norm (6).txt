#!/usr/bin/make -rRsf ????

###########################################
###         -usage 'bless_assembly_with_norm.mk RUN=run CPU=8 MEM=15 READ1=/home/lauren/transcriptome/Pero360T.1.fastq.gz READ2=/home/lauren/transcriptome/Pero360T.2.fastq.gz READ3=/location/of/read3.fastq READ4=/location/of/read4.fastq '
###         -RUN= name of run
###
###
############################################

#$@ is a short hand for target.

##files we need are p_eremics.READNAME.fastq_1&2
#####				mus_musculus.READNAME.fastq_1&2
##### file directories /mnt/data3/lah/mattsclass/p_eremicus  #where output gets put
#####				   /mnt/data3/lah/mattsclass/p_eremicus/raw #reads will be here
#####				   /mnt/data3/lah/mattsclass/mus_musculus #where output gets put
#####				   /mnt/data3/lah/mattsclass/mus_musculus/raw	#reads will be here
#####		Run in mattsclass folder??


MEM=5
#TRIM=5
CPU=5
RUN=run
READ1=/home/lauren/transcriptome/Pero360T.1.fastq.gz
READ2=/home/lauren/transcriptome/Pero360T.2.fastq.gz
READ3=mus_READNAME1.fastq
READ4=mus_READNAME2.fastq

samp1 := p_eremicus
samp2 := mus_musculus

$(CURDIR)/$(samp1)/$(samp1).1.corrected.fastq.gz 						#all output files in order of origination
$(CURDIR)/$(samp1)/$(samp1).2.corrected.fastq.gz
$(CURDIR)/$(samp2)/$(samp2).1.corrected.fastq.gz 
$(CURDIR)/$(samp2)/$(samp2).2.corrected.fastq.gz
$(CURDIR)/$(samp1)/$(samp1).bless_no_norm_trinity.fasta  
$(CURDIR)/$(samp2)/$(samp2).bless_no_norm_trinity.fasta


#############################BLESS##############################################


K=25

#samp1 := p_eremicus#
$(CURDIR)/$(samp1)/$(samp1).1.corrected.fastq.gz $(CURDIR)/$(samp1)/$(samp1).2.corrected.fastq.gz:\ #output files
$(CURDIR)/$(samp1)/raw.$(samp1).READNAME_1.fastq $(CURDIR)/$(samp1)/raw.$(samp1).READNAME_2.fastq #input files (raw reads)
	@echo '\n\n'BEGIN ERROR CORRECTION: `date +'%a %d%b%Y  %H:%M:%S'`
	@echo Results will be in a file named *corrected.fastq.gz
	@echo Settings used: bless kmerlength = $(K)
	bless -kmerlength $(K) -read1 $< -read2 $(word 2,$^) -verify -notrim -prefix $(CURDIR)/$(samp1)/$(samp1)
	gzip $(CURDIR)/$(samp1)/$(samp1).1.bless_corrected.fastq $(CURDIR)/$(samp1)/$(samp1).2.bless_corrected.fastq &

#samp2 := mus_musculus#
$(CURDIR)/$(samp2)/$(samp2).1.corrected.fastq.gz $(CURDIR)/$(samp2)/$(samp2).2.corrected.fastq.gz:\ #output files
$(CURDIR)/$(samp2)/raw.$(samp2).READNAME_1.fastq $(CURDIR)/$(samp2)/raw.$(samp2).READNAME_2.fastq #input files
	@echo '\n\n'BEGIN ERROR CORRECTION: `date +'%a %d%b%Y  %H:%M:%S'`
	@echo Results will be in a file named *corrected.fastq.gz
	@echo Settings used: bless kmerlength = $(K)
	bless -kmerlength $(K) -read1 $< -read2 $(word 2,$^) -verify -notrim -prefix $(CURDIR)/$(samp2)/$(samp2)
	gzip $(CURDIR)/$(samp2)/$(samp2).1.corrected.fastq $(CURDIR)/$(samp2)/$(samp2).2.corrected.fastq &



#######################Trimmomatic/Trinity##########################

#samp1 := p_eremicus#
$(CURDIR)/$(samp1)/(samp1).bless_no_norm_trinity.fasta:\ #output
$(CURDIR)/$(samp1)/$(samp1).1.corrected.fastq.gz $(CURDIR)/$(samp1)/$(samp1).2.corrected.fastq.gz #input from bless
	Trinity --seqType fq --JM 50G --trimmomatic \
    --left $<  \
    --right $(word 2,$^) \
    --CPU $(CPU) --output $(samp1).bless_no_norm_trinity.fasta \  #Does this need to be this > $(samp1)/(samp1).bless_norm_trinity.fasta
    --quality_trimming_params "ILLUMINACLIP:$(CURDIR)/barcodes.fa:2:40:15 LEADING:2 TRAILING:2 MINLEN:25"

#samp2 := mus_musculus#
$(CURDIR)/$(samp2)/bless_no_norm_trinity.fasta:\ #output
$(CURDIR)/$(samp2)/$(samp2).1.corrected.fastq.gz $(CURDIR)/$(samp2)/$(samp2).2.corrected.fastq.gz #input from khmer output
	Trinity --seqType fq --JM 50G --trimmomatic \
    --left $<  \
    --right $(word 2,$^) \
    --CPU $(CPU) --output $(samp2).bless_no_norm_trinity.fasta \
    --quality_trimming_params "ILLUMINACLIP:$(CURDIR)/barcodes.fa:2:40:15 LEADING:2 TRAILING:2 MINLEN:25"